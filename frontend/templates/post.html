<!DOCTYPE html>
<html lang="en">
<head>
  {{template "head" .}}
  <title>Okumi - {{.Post.Title}}</title>
  <link rel="stylesheet" href="/static/styles/style.css" />
  <link rel="stylesheet" href="/static/styles/app.css" />
  <link rel="stylesheet" href="/static/styles/post.css" />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
<main class="main" id="main">
  {{template "loader" .}}
  {{template "navbar" .}}

  <div class="main-back" id="main-back">
    <div class="post-container">

      <!-- Back button -->
      <div class="back-btn-container">
        <a href="/" class="btn btn-primary btn-back" id="btn-back" accesskey="b" title="Go Back">
          <i class="ri-arrow-go-back-line"></i> Back
        </a>
      </div>

      <!-- Post Content -->
      <article class="post-card">
        <!-- Post Header -->
        <div class="post-header">
          <h1 class="post-title">{{.Post.Title}}</h1>

          <div class="post-meta">
            <span class="post-author">@{{.Post.AuthorUsername}}</span>
            <span class="post-date">{{.Post.CreatedAt.Format "Jan 2, 2006"}}</span>
          </div>
        </div>

        <!-- Tags -->
        {{if .Categories}}
        <div class="tags-row">
          {{range .Categories}}
          <a href="#" class="tag tag-filter">{{.Name}}</a>
          {{end}}
        </div>
        {{end}}

        <!-- Post Content -->
        <div class="post-content">
          <p class="post-text">{{.Post.Content}}</p>
        </div>

        <!-- Post Reactions -->
        <div class="post-reactions">
          <form action="/post/{{.Post.ID}}" method="POST">
            <input type="hidden" name="action" value="like">
            <button type="submit" class="btn btn-black">
              <span class="reaction-icon">👍</span>
              <span class="reaction-count">{{.Post.Likes}}</span>
            </button>
          </form>
          <form action="/post/{{.Post.ID}}" method="POST">
            <input type="hidden" name="action" value="dislike">
            <button type="submit" class="btn btn-black">
              <span class="reaction-icon">👎</span>
              <span class="reaction-count">{{.Post.Dislikes}}</span>
            </button>
          </form>
        </div>
      </article>

      <!-- Comments Section -->
      <section class="comments-section">
        <h2 class="comments-title">Comments</h2>

        {{if .Comments}}
        <div class="comments-list">
          {{range .Comments}}
          <div class="comment">
            <div class="comment-header">
              <div class="comment-author">
                <img src="/static/assets/images/user.png" alt="{{.AuthorUsername}}" class="comment-avatar">
                <span class="comment-username">@{{.AuthorUsername}}</span>
              </div>
              <span class="comment-date">{{.CreatedAt.Format "Jan 2, 2006"}}</span>
            </div>

            <div class="comment-content">{{.Content}}</div>

            <div class="comment-reactions">
              <form action="/post/{{$.Post.ID}}" method="POST">
                <input type="hidden" name="action" value="like_comment">
                <input type="hidden" name="comment_id" value="{{.ID}}">
                <button type="submit" class="btn btn-sm btn-outline">
                  <span class="reaction-icon">👍</span>
                  <span class="reaction-count">{{.Likes}}</span>
                </button>
              </form>
              <form action="/post/{{$.Post.ID}}" method="POST">
                <input type="hidden" name="action" value="dislike_comment">
                <input type="hidden" name="comment_id" value="{{.ID}}">
                <button type="submit" class="btn btn-sm btn-outline">
                  <span class="reaction-icon">👎</span>
                  <span class="reaction-count">{{.Dislikes}}</span>
                </button>
              </form>
            </div>
          </div>
          {{end}}
        </div>
        {{else}}
        <p class="no-comments">No comments yet. Be the first to comment!</p>
        {{end}}

        <!-- Comment Form -->
        <form action="/post/{{.Post.ID}}" method="POST" class="comment-form">
          <input type="hidden" name="action" value="comment">
          <textarea name="content" placeholder="Write your comment..." required></textarea>
          <button type="submit" class="btn btn-primary">Post Comment</button>
        </form>
      </section>
    </div>
  </div>
</main>

<script src="/static/scripts/main.js"></script>
<script src="/static/scripts/app.js"></script>
<script src="/static/scripts/post.js"></script>
</body>
</html>